import requests
import re
import os
from dotenv import load_dotenv

load_dotenv()
API_KEY = os.getenv("VIRUSTOTAL_API_KEY")

class Malware:
    def __init__(self, text):
        self.text = text

    def get_info(self):
        malware_details = []
        file_hashes = re.findall(r'\b([a-fA-F0-9]{32}|[a-fA-F0-9]{40}|[a-fA-F0-9]{64})\b', self.text)
        for file_hash in file_hashes:
            response = requests.get(f'https://www.virustotal.com/api/v3/files/{file_hash}', headers={'x-apikey': API_KEY})        
            data = response.json().get('data', {}).get('attributes', {})
            file_info = {
                "name": data.get("names"),
                "sha1": data.get("sha1"),
                "sha256": data.get("sha256"),
                "md5": data.get("md5"),
                "ssdeep": data.get("ssdeep"),
                "vhash": data.get("vhash"),
                "tlsh": data.get("tlsh"),
                "tags": data.get("tags"),
            }
            malware_details.append(file_info)
        return malware_details
    