import requests
import re

class Malware:
  def __init__(self, text):
    self.text = text
    with open("auth.sig") as file:
      self.auth_token = file.read().strip()

  def get_malware_details(self, malware):
    global auth_token
    url = "https://mb-api.abuse.ch/api/v1/"
    headers = {"Auth-Key": self.auth_token}
    query = {
        "query": "get_taginfo",
        "tag": malware,
        "limit": "50"
    }
    req = requests.post(url, data=query, headers=headers)
    print(req.json())
  def get_info(self):
    malware_details = []
    file_hashes = re.findall(r'\b([a-fA-F0-9]{32}|[a-fA-F0-9]{40}|[a-fA-F0-9]{64})\b', self.text)
    for file_hash in file_hashes:
        response = requests.get(f'https://www.virustotal.com/gui/file/{file_hash}')
        soup = BeautifulSoup(response.content, 'html.parser')
        malware_name = soup.find('title').text
        malware_details.append({"name": malware_name, "hash": file_hash})
    return malware_details
